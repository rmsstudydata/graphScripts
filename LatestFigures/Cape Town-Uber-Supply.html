<html>
<head>
<meta charset=utf-8 />
<title>A simple map</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.js'></script>
<script src="rainbowvis.js"></script>
<link href="http://fonts.googleapis.com/css?family=Corben:bold" rel="stylesheet" type="text/css">
 <link href="http://fonts.googleapis.com/css?family=Nobile" rel="stylesheet" type="text/css">
<link href='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.css' rel='stylesheet' />
<style>

  body { margin:0; padding:0; background-color: black; background-image: linear-gradient(to black, grey);}
  .box {
  width: 100%;
  height: 100%;
  display: flex; /* new */
}
h1, h2, h3, h4, h5, h6 {
    font-family: 'Corben', Georgia, Times, serif;
}
p, div {
    font-family: 'Nobile', Helvetica, Arial, sans-serif;
}

#textSegment {

			  text-align:center
        }
   #map {
	border-radius: 25px;

			  width: 60%;
			  height: 90%;
			  margin: auto;
        }

	.text-labels {
            font-size: 0.9em;
            font-weight: 100;
            color: black;
            /* Use color, background, set margins for offset, etc */
        }

	.info { padding: 6px 8px; font: 14px/16px Arial, Helvetica, sans-serif; background: white; background: rgba(255,255,255,0.8); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; } .info h4 { margin: 0 0 5px; color: #777; }
			.legend { text-align: left; line-height: 18px; color: #555; }
			.legend > * {
				display: flex;
				margin-bottom: 5px;
			}
			.legend i { width: 36px; height: 36px; float: left; margin-right: 8px; opacity: 0.7; }
</style>
</head>
<body>

<div id='textSegment'>
<p style="color:white; font-size:25px; padding-top: 20px;"><b><u>Cape Town-Uber Supply Heatmap</u></b></p>
<p style="color:red; font-size:17px; padding-top: 15px;" id = 'updateTime'><b><u>Updated 15 minutes ago</u></b></p>
<p style="color:white; font-size:15px; padding-top: 15px;"><b>Following heatmap shows the average number of <b>Uber<b> cars observed in each block of experiment region between:  <div style="color:red; font-size:15px;">2021-03-28 00:12:40 - 2021-03-28 00:27:40 (EDT)</div> </b></p>
<p style="color:white; font-size:15px; padding-top: 15px;"><b>Next update is scheduled at:  <div style="color:red; font-size:15px;">2021-03-28 00:42:40 (EDT)</div> </b></p>
<p style="color:white; font-size:0px;">Following heatmap shows the number of cars in the different neighborhoods</p>
</div>
<div class="box" style="padding-top: -1000px;"></>

	<div id='map'> </div>
</div>
<script>

function arrayMax(arr) {
  var len = arr.length, max = -Infinity;
  while (len--) {
    if (Number(arr[len]) > max) {
      max = Number(arr[len]);
    }
  }
  return max;
};

function float2int (value) {
    return value | 0;
}

var currentEpoch = 0;
var lastUpdate = 1616905660;


var cityCoords = {};
cityCoords['1-NYC'] =  [[40.77034, -73.99465, 40.7692, -73.99104, 40.76807, -73.98743, 40.76693, -73.98382, 40.76579, -73.98021, 40.76466, -73.9766, 40.76352, -73.97299, 40.76239, -73.96938, 40.76125, -73.96577, 40.76011, -73.96216, 40.75898, -73.95855],
[40.76867, -73.99594, 40.76753, -73.99234, 40.76639, -73.98875, 40.76525, -73.98515, 40.76411, -73.98156, 40.76297, -73.97796, 40.76183, -73.97437, 40.76069, -73.97077, 40.75955, -73.96718, 40.75841, -73.96358, 40.75727, -73.95999],
[40.767, -73.99722, 40.76586, -73.99364, 40.76471, -73.99006, 40.76357, -73.98648, 40.76243, -73.9829, 40.76128, -73.97932, 40.76014, -73.97574, 40.75899, -73.97216, 40.75785, -73.96858, 40.75671, -73.965, 40.75556, -73.96142],
[40.76533, -73.99851, 40.76418, -73.99494, 40.76303, -73.99138, 40.76189, -73.98781, 40.76074, -73.98425, 40.75959, -73.98068, 40.75845, -73.97712, 40.7573, -73.97355, 40.75615, -73.96999, 40.755, -73.96642, 40.75386, -73.96286],
[40.76366, -73.99979, 40.76251, -73.99624, 40.76136, -73.99269, 40.7602, -73.98914, 40.75905, -73.98559, 40.7579, -73.98204, 40.75675, -73.97849, 40.7556, -73.97494, 40.75445, -73.9714, 40.7533, -73.96785, 40.75215, -73.9643],
[40.76199, -74.00108, 40.76083, -73.99754, 40.75968, -73.99401, 40.75852, -73.99047, 40.75737, -73.98694, 40.75621, -73.9834, 40.75506, -73.97987, 40.75391, -73.97634, 40.75275, -73.9728, 40.7516, -73.96927, 40.75044, -73.96573],
[40.76031, -74.00236, 40.75916, -73.99884, 40.758, -73.99532, 40.75684, -73.9918, 40.75568, -73.98828, 40.75453, -73.98477, 40.75337, -73.98125, 40.75221, -73.97773, 40.75105, -73.97421, 40.7499, -73.97069, 40.74874, -73.96717],
[40.75864, -74.00365, 40.75748, -74.00014, 40.75632, -73.99664, 40.75516, -73.99313, 40.754, -73.98963, 40.75284, -73.98613, 40.75168, -73.98262, 40.75052, -73.97912, 40.74935, -73.97561, 40.74819, -73.97211, 40.74703, -73.9686],
[40.75697, -74.00493, 40.75581, -74.00144, 40.75464, -73.99795, 40.75348, -73.99446, 40.75231, -73.99098, 40.75115, -73.98749, 40.74999, -73.984, 40.74882, -73.98051, 40.74766, -73.97702, 40.74649, -73.97353, 40.74533, -73.97004],
[40.7553, -74.00622, 40.75413, -74.00274, 40.75297, -73.99927, 40.7518, -73.9958, 40.75063, -73.99232, 40.74946, -73.98885, 40.74829, -73.98537, 40.74712, -73.9819, 40.74596, -73.97843, 40.74479, -73.97495, 40.74362, -73.97148],
[40.75363, -74.0075, 40.75246, -74.00404, 40.75129, -74.00058, 40.75012, -73.99713, 40.74894, -73.99367, 40.74777, -73.99021, 40.7466, -73.98675, 40.74543, -73.98329, 40.74426, -73.97983, 40.74309, -73.97637, 40.74191, -73.97291]
];

cityCoords['3-CPT'] =  [[-33.88334, 18.40643, -33.88607, 18.41275, -33.88881, 18.41906, -33.89155, 18.42537, -33.89429, 18.43169, -33.89703, 18.438, -33.89977, 18.44431, -33.90251, 18.45062, -33.90525, 18.45694, -33.90799, 18.46325, -33.91073, 18.46956, -33.91347, 18.47588, -33.91621, 18.48219],
[-33.88707, 18.40321, -33.88998, 18.40934, -33.8929, 18.41547, -33.89581, 18.4216, -33.89873, 18.42773, -33.90164, 18.43385, -33.90456, 18.43998, -33.90747, 18.44611, -33.91039, 18.45224, -33.9133, 18.45836, -33.91622, 18.46449, -33.91913, 18.47062, -33.92205, 18.47675],
[-33.8908, 18.39999, -33.89389, 18.40594, -33.89698, 18.41188, -33.90008, 18.41782, -33.90317, 18.42376, -33.90626, 18.42971, -33.90935, 18.43565, -33.91244, 18.44159, -33.91553, 18.44753, -33.91862, 18.45348, -33.92171, 18.45942, -33.9248, 18.46536, -33.92789, 18.4713],
[-33.89454, 18.39677, -33.8978, 18.40253, -33.90107, 18.40829, -33.90434, 18.41405, -33.9076, 18.4198, -33.91087, 18.42556, -33.91413, 18.43132, -33.9174, 18.43707, -33.92066, 18.44283, -33.92393, 18.44859, -33.92719, 18.45435, -33.93046, 18.4601, -33.93373, 18.46586],
[-33.89827, 18.39356, -33.90171, 18.39913, -33.90515, 18.4047, -33.90859, 18.41027, -33.91204, 18.41584, -33.91548, 18.42141, -33.91892, 18.42699, -33.92236, 18.43256, -33.9258, 18.43813, -33.92924, 18.4437, -33.93268, 18.44927, -33.93612, 18.45485, -33.93957, 18.46042],
[-33.90201, 18.39034, -33.90562, 18.39572, -33.90924, 18.40111, -33.91286, 18.4065, -33.91647, 18.41188, -33.92009, 18.41727, -33.9237, 18.42266, -33.92732, 18.42804, -33.93094, 18.43343, -33.93456, 18.43881, -33.93817, 18.4442, -33.94179, 18.44959, -33.94541, 18.45497],
[-33.90574, 18.38712, -33.90953, 18.39232, -33.91333, 18.39752, -33.91712, 18.40272, -33.92091, 18.40792, -33.9247, 18.41312, -33.92849, 18.41832, -33.93228, 18.42352, -33.93608, 18.42873, -33.93987, 18.43393, -33.94366, 18.43913, -33.94745, 18.44433, -33.95124, 18.44953],
[-33.90948, 18.3839, -33.91344, 18.38891, -33.91741, 18.39393, -33.92138, 18.39895, -33.92534, 18.40396, -33.92931, 18.40898, -33.93328, 18.41399, -33.93725, 18.41901, -33.94121, 18.42402, -33.94518, 18.42904, -33.94915, 18.43405, -33.95312, 18.43907, -33.95708, 18.44409],
[-33.91321, 18.38068, -33.91735, 18.38551, -33.9215, 18.39034, -33.92564, 18.39517, -33.92978, 18.4, -33.93392, 18.40483, -33.93807, 18.40966, -33.94221, 18.41449, -33.94635, 18.41932, -33.95049, 18.42415, -33.95464, 18.42898, -33.95878, 18.43381, -33.96292, 18.43864],
[-33.91694, 18.37746, -33.92126, 18.38211, -33.92558, 18.38675, -33.9299, 18.3914, -33.93422, 18.39604, -33.93853, 18.40068, -33.94285, 18.40533, -33.94717, 18.40997, -33.95149, 18.41462, -33.95581, 18.41926, -33.96012, 18.42391, -33.96444, 18.42855, -33.96876, 18.4332],
[-33.92068, 18.37424, -33.92517, 18.3787, -33.92966, 18.38316, -33.93416, 18.38762, -33.93865, 18.39208, -33.94315, 18.39654, -33.94764, 18.401, -33.95213, 18.40546, -33.95663, 18.40992, -33.96112, 18.41438, -33.96561, 18.41884, -33.97011, 18.4233, -33.9746, 18.42776],
[-33.92441, 18.37102, -33.92908, 18.3753, -33.93375, 18.37957, -33.93842, 18.38384, -33.94309, 18.38812, -33.94776, 18.39239, -33.95243, 18.39667, -33.9571, 18.40094, -33.96176, 18.40522, -33.96643, 18.40949, -33.9711, 18.41376, -33.97577, 18.41804, -33.98044, 18.42231],
[-33.92815, 18.3678, -33.93299, 18.37189, -33.93783, 18.37598, -33.94268, 18.38007, -33.94752, 18.38416, -33.95237, 18.38825, -33.95721, 18.39234, -33.96206, 18.39642, -33.9669, 18.40051, -33.97175, 18.4046, -33.97659, 18.40869, -33.98144, 18.41278, -33.98628, 18.41687],
];


cityCoords['4-DEL'] =   [[28.6467, 77.21061, 28.6452, 77.2142, 28.6437, 77.21779, 28.6422, 77.22138, 28.6407, 77.22497, 28.6392, 77.22856, 28.6377, 77.23214, 28.6362, 77.23573, 28.6347, 77.23932, 28.6332, 77.24291, 28.6317, 77.2465],
[28.64441, 77.20757, 28.64287, 77.21124, 28.64132, 77.21492, 28.63977, 77.21859, 28.63822, 77.22226, 28.63668, 77.22593, 28.63513, 77.22961, 28.63358, 77.23328, 28.63203, 77.23695, 28.63049, 77.24063, 28.62894, 77.2443],
[28.64212, 77.20453, 28.64053, 77.20828, 28.63893, 77.21204, 28.63734, 77.2158, 28.63574, 77.21956, 28.63415, 77.22331, 28.63255, 77.22707, 28.63096, 77.23083, 28.62937, 77.23459, 28.62777, 77.23834, 28.62618, 77.2421],
[28.63983, 77.20148, 28.63819, 77.20532, 28.63655, 77.20917, 28.6349, 77.21301, 28.63326, 77.21685, 28.63162, 77.22069, 28.62998, 77.22453, 28.62834, 77.22838, 28.6267, 77.23222, 28.62506, 77.23606, 28.62342, 77.2399],
[28.63754, 77.19844, 28.63585, 77.20236, 28.63416, 77.20629, 28.63247, 77.21022, 28.63078, 77.21414, 28.62909, 77.21807, 28.62741, 77.222, 28.62572, 77.22592, 28.62403, 77.22985, 28.62234, 77.23378, 28.62065, 77.2377],
[28.63524, 77.19539, 28.63351, 77.1994, 28.63177, 77.20342, 28.63004, 77.20743, 28.6283, 77.21144, 28.62657, 77.21545, 28.62483, 77.21946, 28.6231, 77.22347, 28.62136, 77.22748, 28.61963, 77.23149, 28.61789, 77.2355],
[28.63295, 77.19235, 28.63117, 77.19645, 28.62939, 77.20054, 28.62761, 77.20464, 28.62582, 77.20873, 28.62404, 77.21283, 28.62226, 77.21692, 28.62048, 77.22102, 28.61869, 77.22511, 28.61691, 77.22921, 28.61513, 77.23331],
[28.63066, 77.18931, 28.62883, 77.19349, 28.627, 77.19767, 28.62517, 77.20185, 28.62334, 77.20603, 28.62151, 77.21021, 28.61969, 77.21439, 28.61786, 77.21857, 28.61603, 77.22275, 28.6142, 77.22693, 28.61237, 77.23111],
[28.62837, 77.18626, 28.62649, 77.19053, 28.62462, 77.19479, 28.62274, 77.19906, 28.62086, 77.20332, 28.61899, 77.20758, 28.61711, 77.21185, 28.61523, 77.21611, 28.61336, 77.22038, 28.61148, 77.22464, 28.60961, 77.22891],
[28.62608, 77.18322, 28.62415, 77.18757, 28.62223, 77.19192, 28.62031, 77.19626, 28.61838, 77.20061, 28.61646, 77.20496, 28.61454, 77.20931, 28.61262, 77.21366, 28.61069, 77.21801, 28.60877, 77.22236, 28.60684, 77.22671],
[28.62379, 77.18017, 28.62182, 77.18461, 28.61985, 77.18904, 28.61787, 77.19347, 28.6159, 77.19791, 28.61393, 77.20234, 28.61196, 77.20678, 28.60999, 77.21121, 28.60802, 77.21564, 28.60605, 77.22008, 28.60408, 77.22451],
];

cityCoords['5-DXB'] =  [[25.24088, 55.26671, 25.23904, 55.27043, 25.2372, 55.27416, 25.23535, 55.27789, 25.23351, 55.28162, 25.23166, 55.28534, 25.22982, 55.28907, 25.22798, 55.2928, 25.22613, 55.29653, 25.22429, 55.30025, 25.22245, 55.30398, 25.2206, 55.30771],
[25.23637, 55.2631, 25.23448, 55.26699, 25.23258, 55.27088, 25.23069, 55.27476, 25.22879, 55.27865, 25.22689, 55.28254, 25.225, 55.28643, 25.2231, 55.29031, 25.22121, 55.2942, 25.21931, 55.29809, 25.21742, 55.30197, 25.21552, 55.30586],
[25.23186, 55.2595, 25.22992, 55.26354, 25.22797, 55.26759, 25.22602, 55.27164, 25.22407, 55.27569, 25.22212, 55.27973, 25.22018, 55.28378, 25.21823, 55.28783, 25.21628, 55.29187, 25.21433, 55.29592, 25.21239, 55.29997, 25.21044, 55.30402],
[25.22735, 55.25589, 25.22536, 55.2601, 25.22336, 55.26431, 25.22135, 55.26851, 25.21936, 55.27272, 25.21736, 55.27693, 25.21535, 55.28113, 25.21335, 55.28534, 25.21135, 55.28955, 25.20935, 55.29375, 25.20735, 55.29796, 25.20535, 55.30217],
[25.22285, 55.25229, 25.22079, 55.25665, 25.21874, 55.26102, 25.21669, 55.26539, 25.21464, 55.26976, 25.21259, 55.27412, 25.21053, 55.27849, 25.20848, 55.28286, 25.20643, 55.28722, 25.20438, 55.29159, 25.20232, 55.29596, 25.20027, 55.30032],
[25.21834, 55.24868, 25.21623, 55.25321, 25.21413, 55.25774, 25.21202, 55.26226, 25.20992, 55.26679, 25.20781, 55.27132, 25.20571, 55.27584, 25.2036, 55.28037, 25.2015, 55.2849, 25.1994, 55.28942, 25.19729, 55.29395, 25.19519, 55.29848],
[25.21383, 55.24508, 25.21167, 55.24977, 25.20951, 55.25445, 25.20736, 55.25914, 25.2052, 55.26382, 25.20304, 55.26851, 25.20089, 55.2732, 25.19873, 55.27788, 25.19657, 55.28257, 25.19442, 55.28726, 25.19226, 55.29194, 25.1901, 55.29663],
[25.20932, 55.24147, 25.20711, 55.24632, 25.2049, 55.25117, 25.20269, 55.25601, 25.20048, 55.26086, 25.19827, 55.26571, 25.19607, 55.27055, 25.19386, 55.2754, 25.19165, 55.28025, 25.18944, 55.28509, 25.18723, 55.28994, 25.18502, 55.29478],
[25.20481, 55.23787, 25.20255, 55.24288, 25.20029, 55.24788, 25.19803, 55.25289, 25.19577, 55.25789, 25.1935, 55.2629, 25.19124, 55.26791, 25.18898, 55.27291, 25.18672, 55.27792, 25.18446, 55.28293, 25.1822, 55.28793, 25.17994, 55.29294],
[25.2003, 55.23427, 25.19799, 55.23943, 25.19567, 55.2446, 25.19336, 55.24976, 25.19105, 55.25493, 25.18873, 55.2601, 25.18642, 55.26526, 25.18411, 55.27043, 25.18179, 55.27559, 25.17948, 55.28076, 25.17717, 55.28593, 25.17486, 55.29109],
[25.19579, 55.23066, 25.19342, 55.23599, 25.19106, 55.24131, 25.18869, 55.24664, 25.18633, 55.25196, 25.18396, 55.25729, 25.1816, 55.26262, 25.17923, 55.26794, 25.17687, 55.27327, 25.1745, 55.27859, 25.17214, 55.28392, 25.16977, 55.28925],
[25.19128, 55.22706, 25.18886, 55.23254, 25.18644, 55.23803, 25.18403, 55.24351, 25.18161, 55.249, 25.17919, 55.25449, 25.17678, 55.25997, 25.17436, 55.26546, 25.17194, 55.27094, 25.16952, 55.27643, 25.16711, 55.28191, 25.16469, 55.2874],
];


cityCoords['6-LDN'] =  [[51.52223, -0.14125, 51.52072, -0.13702, 51.51921, -0.13279, 51.5177, -0.12855, 51.5162, -0.12432, 51.51469, -0.12009, 51.51318, -0.11586, 51.51167, -0.11162, 51.51016, -0.10739, 51.50865, -0.10316, 51.50714, -0.09892, 51.50564, -0.09469],
[51.52044, -0.14508, 51.51888, -0.14086, 51.51732, -0.13664, 51.51575, -0.13243, 51.51419, -0.12821, 51.51263, -0.12399, 51.51106, -0.11977, 51.5095, -0.11556, 51.50794, -0.11134, 51.50637, -0.10712, 51.50481, -0.10291, 51.50324, -0.09869],
[51.51866, -0.1489, 51.51704, -0.1447, 51.51542, -0.1405, 51.5138, -0.1363, 51.51219, -0.1321, 51.51057, -0.1279, 51.50895, -0.12369, 51.50733, -0.11949, 51.50571, -0.11529, 51.50409, -0.11109, 51.50247, -0.10689, 51.50085, -0.10269],
[51.51688, -0.15273, 51.5152, -0.14854, 51.51353, -0.14436, 51.51185, -0.14017, 51.51018, -0.13598, 51.50851, -0.1318, 51.50683, -0.12761, 51.50516, -0.12343, 51.50348, -0.11924, 51.50181, -0.11506, 51.50014, -0.11087, 51.49846, -0.10669],
[51.51509, -0.15655, 51.51336, -0.15238, 51.51163, -0.14821, 51.5099, -0.14404, 51.50818, -0.13987, 51.50645, -0.1357, 51.50472, -0.13153, 51.50299, -0.12736, 51.50126, -0.12319, 51.49953, -0.11903, 51.4978, -0.11486, 51.49607, -0.11069],
[51.51331, -0.16037, 51.51152, -0.15622, 51.50974, -0.15207, 51.50795, -0.14791, 51.50617, -0.14376, 51.50438, -0.13961, 51.5026, -0.13545, 51.50082, -0.1313, 51.49903, -0.12715, 51.49725, -0.12299, 51.49546, -0.11884, 51.49368, -0.11469],
[51.51152, -0.1642, 51.50968, -0.16006, 51.50784, -0.15592, 51.506, -0.15179, 51.50416, -0.14765, 51.50232, -0.14351, 51.50048, -0.13937, 51.49865, -0.13524, 51.49681, -0.1311, 51.49497, -0.12696, 51.49313, -0.12282, 51.49129, -0.11868],
[51.50974, -0.16802, 51.50784, -0.1639, 51.50595, -0.15978, 51.50405, -0.15566, 51.50216, -0.15154, 51.50026, -0.14741, 51.49837, -0.14329, 51.49647, -0.13917, 51.49458, -0.13505, 51.49269, -0.13093, 51.49079, -0.12681, 51.48889, -0.12268],
[51.50796, -0.17185, 51.50601, -0.16774, 51.50406, -0.16364, 51.50211, -0.15953, 51.50015, -0.15542, 51.4982, -0.15132, 51.49625, -0.14721, 51.4943, -0.14311, 51.49235, -0.139, 51.4904, -0.13489, 51.48845, -0.13079, 51.4865, -0.12668],
[51.50617, -0.17567, 51.50417, -0.17158, 51.50216, -0.16749, 51.50015, -0.1634, 51.49815, -0.15931, 51.49614, -0.15522, 51.49414, -0.15113, 51.49213, -0.14704, 51.49013, -0.14295, 51.48812, -0.13886, 51.48612, -0.13477, 51.48411, -0.13068],
[51.50439, -0.1795, 51.50233, -0.17542, 51.50027, -0.17135, 51.4982, -0.16727, 51.49614, -0.1632, 51.49408, -0.15913, 51.49202, -0.15505, 51.48996, -0.15098, 51.4879, -0.1469, 51.48584, -0.14283, 51.48378, -0.13875, 51.48172, -0.13468],
[51.5026, -0.18332, 51.50049, -0.17926, 51.49837, -0.1752, 51.49626, -0.17115, 51.49414, -0.16709, 51.49202, -0.16303, 51.48991, -0.15897, 51.48779, -0.15491, 51.48568, -0.15085, 51.48356, -0.1468, 51.48145, -0.14274, 51.47933, -0.13868],
];

cityCoords['7-MELB'] = [[-37.79707, 144.92956, -37.79605, 144.93509, -37.79502, 144.94062, -37.794, 144.94615, -37.79297, 144.95168, -37.79194, 144.95721, -37.79091, 144.96274, -37.78989, 144.96827, -37.78886, 144.97379, -37.78783, 144.97932, -37.78681, 144.98485, -37.78578, 144.99038],
[-37.80027, 144.93147, -37.7993, 144.937, -37.79832, 144.94254, -37.79734, 144.94808, -37.79636, 144.95361, -37.79538, 144.95915, -37.7944, 144.96468, -37.79342, 144.97022, -37.79244, 144.97575, -37.79146, 144.98129, -37.79048, 144.98682, -37.7895, 144.99236],
[-37.80347, 144.93338, -37.80254, 144.93892, -37.80161, 144.94446, -37.80068, 144.95, -37.79975, 144.95554, -37.79882, 144.96108, -37.79789, 144.96663, -37.79695, 144.97217, -37.79602, 144.97771, -37.79509, 144.98325, -37.79416, 144.98879, -37.79323, 144.99433],
[-37.80667, 144.93528, -37.80579, 144.94083, -37.80491, 144.94638, -37.80402, 144.95193, -37.80314, 144.95748, -37.80226, 144.96302, -37.80137, 144.96857, -37.80049, 144.97412, -37.7996, 144.97967, -37.79872, 144.98522, -37.79784, 144.99076, -37.79695, 144.99631],
[-37.80987, 144.93719, -37.80904, 144.94275, -37.8082, 144.9483, -37.80736, 144.95385, -37.80653, 144.95941, -37.80569, 144.96496, -37.80486, 144.97052, -37.80402, 144.97607, -37.80318, 144.98163, -37.80235, 144.98718, -37.80151, 144.99273, -37.80068, 144.99829],
[-37.81307, 144.9391, -37.81229, 144.94466, -37.8115, 144.95022, -37.81071, 144.95578, -37.80992, 144.96134, -37.80913, 144.9669, -37.80834, 144.97246, -37.80755, 144.97802, -37.80677, 144.98358, -37.80598, 144.98914, -37.80519, 144.9947, -37.8044, 145.00026],
[-37.81627, 144.94101, -37.81553, 144.94657, -37.81479, 144.95214, -37.81405, 144.95771, -37.81331, 144.96327, -37.81257, 144.96884, -37.81183, 144.97441, -37.81109, 144.97997, -37.81035, 144.98554, -37.80961, 144.99111, -37.80887, 144.99667, -37.80812, 145.00224],
[-37.81947, 144.94291, -37.81878, 144.94849, -37.81809, 144.95406, -37.81739, 144.95963, -37.8167, 144.96521, -37.81601, 144.97078, -37.81531, 144.97635, -37.81462, 144.98193, -37.81393, 144.9875, -37.81323, 144.99307, -37.81254, 144.99864, -37.81185, 145.00422],
[-37.82267, 144.94482, -37.82203, 144.9504, -37.82138, 144.95598, -37.82073, 144.96156, -37.82009, 144.96714, -37.81945, 144.97272, -37.8188, 144.9783, -37.81815, 144.98388, -37.81751, 144.98946, -37.81686, 144.99504, -37.81622, 145.00062, -37.81557, 145.00619],
[-37.82587, 144.94673, -37.82527, 144.95231, -37.82468, 144.9579, -37.82408, 144.96349, -37.82348, 144.96907, -37.82288, 144.97466, -37.82229, 144.98024, -37.82169, 144.98583, -37.82109, 144.99141, -37.82049, 144.997, -37.8199, 145.00259, -37.8193, 145.00817],
[-37.82907, 144.94864, -37.82852, 144.95423, -37.82797, 144.95982, -37.82742, 144.96541, -37.82687, 144.971, -37.82632, 144.9766, -37.82577, 144.98219, -37.82522, 144.98778, -37.82467, 144.99337, -37.82412, 144.99896, -37.82357, 145.00456, -37.82302, 145.01015],
[-37.83227, 144.95054, -37.83177, 144.95614, -37.83127, 144.96174, -37.83076, 144.96734, -37.83026, 144.97294, -37.82976, 144.97854, -37.82926, 144.98413, -37.82876, 144.98973, -37.82825, 144.99533, -37.82775, 145.00093, -37.82725, 145.00653, -37.82675, 145.01212],
];

cityCoords['8-MEX'] =  [[19.44071, -99.16474, 19.44137, -99.15695, 19.44204, -99.14915, 19.4427, -99.14136, 19.44336, -99.13356, 19.44402, -99.12577, 19.44469, -99.11797, 19.44535, -99.11018, 19.44601, -99.10239, 19.44668, -99.09459, 19.44734, -99.0868, 19.448, -99.079],
[19.43511, -99.16396, 19.43573, -99.15618, 19.43636, -99.1484, 19.43698, -99.14062, 19.43761, -99.13284, 19.43823, -99.12506, 19.43886, -99.11728, 19.43948, -99.1095, 19.4401, -99.10172, 19.44073, -99.09394, 19.44135, -99.08616, 19.44198, -99.07838],
[19.42951, -99.16318, 19.43009, -99.15541, 19.43068, -99.14765, 19.43126, -99.13988, 19.43185, -99.13211, 19.43244, -99.12435, 19.43302, -99.11658, 19.43361, -99.10882, 19.4342, -99.10105, 19.43478, -99.09328, 19.43537, -99.08552, 19.43595, -99.07775],
[19.42391, -99.1624, 19.42445, -99.15464, 19.425, -99.14689, 19.42555, -99.13914, 19.4261, -99.13139, 19.42664, -99.12364, 19.42719, -99.11589, 19.42774, -99.10813, 19.42829, -99.10038, 19.42883, -99.09263, 19.42938, -99.08488, 19.42993, -99.07713],
[19.41831, -99.16161, 19.41881, -99.15388, 19.41932, -99.14614, 19.41983, -99.1384, 19.42034, -99.13066, 19.42085, -99.12293, 19.42136, -99.11519, 19.42187, -99.10745, 19.42238, -99.09972, 19.42289, -99.09198, 19.4234, -99.08424, 19.42391, -99.0765],
[19.4127, -99.16083, 19.41317, -99.15311, 19.41364, -99.14539, 19.41412, -99.13766, 19.41459, -99.12994, 19.41506, -99.12222, 19.41553, -99.11449, 19.416, -99.10677, 19.41647, -99.09905, 19.41694, -99.09132, 19.41741, -99.0836, 19.41788, -99.07588],
[19.4071, -99.16005, 19.40753, -99.15234, 19.40797, -99.14463, 19.4084, -99.13692, 19.40883, -99.12922, 19.40926, -99.12151, 19.4097, -99.1138, 19.41013, -99.10609, 19.41056, -99.09838, 19.41099, -99.09067, 19.41142, -99.08296, 19.41186, -99.07525],
[19.4015, -99.15927, 19.4019, -99.15157, 19.40229, -99.14388, 19.40268, -99.13619, 19.40308, -99.12849, 19.40347, -99.1208, 19.40386, -99.1131, 19.40426, -99.10541, 19.40465, -99.09771, 19.40505, -99.09002, 19.40544, -99.08232, 19.40583, -99.07463],
[19.3959, -99.15849, 19.39626, -99.15081, 19.39661, -99.14313, 19.39697, -99.13545, 19.39732, -99.12777, 19.39768, -99.12009, 19.39803, -99.1124, 19.39839, -99.10472, 19.39874, -99.09704, 19.3991, -99.08936, 19.39945, -99.08168, 19.39981, -99.074],
[19.3903, -99.15771, 19.39062, -99.15004, 19.39093, -99.14237, 19.39125, -99.13471, 19.39157, -99.12704, 19.39188, -99.11938, 19.3922, -99.11171, 19.39252, -99.10404, 19.39283, -99.09638, 19.39315, -99.08871, 19.39347, -99.08104, 19.39378, -99.07338],
[19.3847, -99.15693, 19.38498, -99.14927, 19.38526, -99.14162, 19.38553, -99.13397, 19.38581, -99.12632, 19.38609, -99.11866, 19.38637, -99.11101, 19.38665, -99.10336, 19.38692, -99.09571, 19.3872, -99.08806, 19.38748, -99.0804, 19.38776, -99.07275],
[19.3791, -99.15614, 19.37934, -99.14851, 19.37958, -99.14087, 19.37982, -99.13323, 19.38006, -99.12559, 19.3803, -99.11795, 19.38054, -99.11032, 19.38077, -99.10268, 19.38102, -99.09504, 19.38125, -99.0874, 19.38149, -99.07976, 19.38173, -99.07213],
];

cityCoords['9-PAR'] = [[48.87173, 2.34253, 48.87067, 2.34657, 48.86962, 2.3506, 48.86856, 2.35463, 48.8675, 2.35867, 48.86644, 2.3627, 48.86538, 2.36673, 48.86432, 2.37077, 48.86326, 2.3748, 48.8622, 2.37883, 48.86114, 2.38287, 48.86008, 2.3869, 48.85902, 2.39094, 48.85797, 2.39497],
[48.86784, 2.33918, 48.86681, 2.34327, 48.86579, 2.34737, 48.86476, 2.35147, 48.86373, 2.35556, 48.8627, 2.35966, 48.86168, 2.36375, 48.86065, 2.36785, 48.85962, 2.37195, 48.8586, 2.37604, 48.85757, 2.38014, 48.85654, 2.38423, 48.85551, 2.38833, 48.85448, 2.39243],
[48.86395, 2.33582, 48.86295, 2.33998, 48.86196, 2.34414, 48.86096, 2.3483, 48.85997, 2.35246, 48.85897, 2.35662, 48.85797, 2.36077, 48.85698, 2.36493, 48.85598, 2.36909, 48.85499, 2.37325, 48.85399, 2.37741, 48.853, 2.38157, 48.852, 2.38573, 48.851, 2.38988],
[48.86006, 2.33247, 48.85909, 2.33669, 48.85813, 2.34091, 48.85716, 2.34513, 48.8562, 2.34935, 48.85524, 2.35357, 48.85427, 2.35779, 48.85331, 2.36202, 48.85234, 2.36624, 48.85138, 2.37046, 48.85042, 2.37468, 48.84945, 2.3789, 48.84849, 2.38312, 48.84752, 2.38734],
[48.85616, 2.32911, 48.85523, 2.3334, 48.8543, 2.33768, 48.85337, 2.34196, 48.85243, 2.34625, 48.8515, 2.35053, 48.85057, 2.35481, 48.84964, 2.3591, 48.84871, 2.36338, 48.84777, 2.36767, 48.84684, 2.37195, 48.84591, 2.37623, 48.84497, 2.38052, 48.84404, 2.3848],
[48.85227, 2.32576, 48.85137, 2.3301, 48.85047, 2.33445, 48.84957, 2.33879, 48.84867, 2.34314, 48.84777, 2.34749, 48.84687, 2.35183, 48.84597, 2.35618, 48.84507, 2.36053, 48.84417, 2.36487, 48.84327, 2.36922, 48.84236, 2.37357, 48.84146, 2.37791, 48.84056, 2.38226],
[48.84838, 2.3224, 48.84751, 2.32681, 48.84664, 2.33122, 48.84577, 2.33563, 48.8449, 2.34004, 48.84403, 2.34445, 48.84317, 2.34885, 48.8423, 2.35326, 48.84143, 2.35767, 48.84056, 2.36208, 48.83969, 2.36649, 48.83882, 2.3709, 48.83795, 2.37531, 48.83708, 2.37972],
[48.84449, 2.31904, 48.84365, 2.32352, 48.84281, 2.32799, 48.84197, 2.33246, 48.84114, 2.33693, 48.8403, 2.3414, 48.83946, 2.34587, 48.83863, 2.35035, 48.83779, 2.35482, 48.83695, 2.35929, 48.83611, 2.36376, 48.83528, 2.36823, 48.83444, 2.3727, 48.8336, 2.37717],
[48.8406, 2.31569, 48.83979, 2.32022, 48.83898, 2.32476, 48.83818, 2.32929, 48.83737, 2.33383, 48.83657, 2.33836, 48.83576, 2.34289, 48.83496, 2.34743, 48.83415, 2.35196, 48.83334, 2.3565, 48.83254, 2.36103, 48.83173, 2.36556, 48.83093, 2.3701, 48.83012, 2.37463],
[48.8367, 2.31233, 48.83593, 2.31693, 48.83516, 2.32153, 48.83438, 2.32612, 48.83361, 2.33072, 48.83283, 2.33532, 48.83206, 2.33991, 48.83129, 2.34451, 48.83051, 2.34911, 48.82974, 2.3537, 48.82896, 2.3583, 48.82819, 2.3629, 48.82742, 2.36749, 48.82664, 2.37209],
[48.83281, 2.30898, 48.83207, 2.31364, 48.83133, 2.3183, 48.83058, 2.32296, 48.82984, 2.32762, 48.8291, 2.33227, 48.82836, 2.33693, 48.82762, 2.34159, 48.82687, 2.34625, 48.82613, 2.35091, 48.82539, 2.35557, 48.82465, 2.36023, 48.8239, 2.36489, 48.82316, 2.36955],
[48.82892, 2.30562, 48.82821, 2.31034, 48.8275, 2.31507, 48.82679, 2.31979, 48.82608, 2.32451, 48.82536, 2.32923, 48.82465, 2.33395, 48.82394, 2.33868, 48.82323, 2.3434, 48.82252, 2.34812, 48.82181, 2.35284, 48.8211, 2.35756, 48.82039, 2.36228, 48.81968, 2.36701],
[48.82503, 2.30227, 48.82435, 2.30705, 48.82367, 2.31184, 48.82299, 2.31662, 48.82231, 2.32141, 48.82163, 2.32619, 48.82095, 2.33097, 48.82027, 2.33576, 48.81959, 2.34054, 48.81892, 2.34533, 48.81824, 2.35011, 48.81756, 2.3549, 48.81688, 2.35968, 48.8162, 2.36446],
[48.82113, 2.29891, 48.82049, 2.30376, 48.81984, 2.30861, 48.81919, 2.31345, 48.81855, 2.3183, 48.8179, 2.32315, 48.81725, 2.32799, 48.8166, 2.33284, 48.81596, 2.33769, 48.81531, 2.34253, 48.81466, 2.34738, 48.81401, 2.35223, 48.81337, 2.35707, 48.81272, 2.36192],
];

cityCoords['2-YTO'] = [[43.66469, -79.43865, 43.66579, -79.43292, 43.66688, -79.42719, 43.66798, -79.42146, 43.66908, -79.41573, 43.67017, -79.41, 43.67127, -79.40427, 43.67236, -79.39854, 43.67346, -79.39281, 43.67456, -79.38708, 43.67565, -79.38135, 43.67675, -79.37562],
[43.66048, -79.43721, 43.66157, -79.43141, 43.66266, -79.4256, 43.66375, -79.4198, 43.66484, -79.41399, 43.66593, -79.40819, 43.66702, -79.40238, 43.6681, -79.39657, 43.66919, -79.39077, 43.67028, -79.38496, 43.67137, -79.37916, 43.67246, -79.37335],
[43.65627, -79.43577, 43.65735, -79.42989, 43.65843, -79.42401, 43.65952, -79.41813, 43.6606, -79.41225, 43.66168, -79.40637, 43.66276, -79.40049, 43.66385, -79.39461, 43.66493, -79.38873, 43.66601, -79.38285, 43.66709, -79.37697, 43.66817, -79.37108],
[43.65206, -79.43433, 43.65314, -79.42837, 43.65421, -79.42242, 43.65529, -79.41646, 43.65636, -79.41051, 43.65744, -79.40455, 43.65851, -79.3986, 43.65958, -79.39264, 43.66066, -79.38668, 43.66174, -79.38073, 43.66281, -79.37477, 43.66388, -79.36882],
[43.64785, -79.43289, 43.64892, -79.42686, 43.64999, -79.42083, 43.65105, -79.4148, 43.65212, -79.40876, 43.65319, -79.40273, 43.65426, -79.3967, 43.65532, -79.39067, 43.65639, -79.38464, 43.65746, -79.37861, 43.65853, -79.37258, 43.6596, -79.36655],
[43.64364, -79.43145, 43.6447, -79.42534, 43.64576, -79.41923, 43.64682, -79.41313, 43.64788, -79.40702, 43.64894, -79.40092, 43.65001, -79.39481, 43.65107, -79.38871, 43.65212, -79.3826, 43.65319, -79.37649, 43.65425, -79.37039, 43.65531, -79.36428],
[43.63943, -79.43, 43.64049, -79.42382, 43.64154, -79.41764, 43.64259, -79.41146, 43.64365, -79.40528, 43.6447, -79.3991, 43.64575, -79.39292, 43.64681, -79.38674, 43.64786, -79.38056, 43.64891, -79.37438, 43.64997, -79.36819, 43.65102, -79.36201],
[43.63522, -79.42856, 43.63627, -79.42231, 43.63732, -79.41605, 43.63836, -79.40979, 43.63941, -79.40354, 43.64045, -79.39728, 43.6415, -79.39103, 43.64254, -79.38477, 43.64359, -79.37851, 43.64464, -79.37226, 43.64568, -79.366, 43.64673, -79.35975],
[43.63101, -79.42712, 43.63205, -79.42079, 43.63309, -79.41446, 43.63413, -79.40813, 43.63517, -79.4018, 43.63621, -79.39546, 43.63725, -79.38913, 43.63829, -79.3828, 43.63932, -79.37647, 43.64036, -79.37014, 43.6414, -79.36381, 43.64244, -79.35748],
[43.62681, -79.42568, 43.62784, -79.41927, 43.62887, -79.41287, 43.6299, -79.40646, 43.63093, -79.40005, 43.63196, -79.39365, 43.63299, -79.38724, 43.63403, -79.38084, 43.63506, -79.37443, 43.63609, -79.36802, 43.63712, -79.36162, 43.63815, -79.35521],
[43.6226, -79.42424, 43.62362, -79.41776, 43.62464, -79.41127, 43.62567, -79.40479, 43.62669, -79.39831, 43.62772, -79.39183, 43.62874, -79.38535, 43.62976, -79.37887, 43.63079, -79.37239, 43.63181, -79.36591, 43.63284, -79.35942, 43.63386, -79.35294],
[43.61839, -79.42279, 43.6194, -79.41624, 43.62042, -79.40968, 43.62144, -79.40313, 43.62246, -79.39657, 43.62347, -79.39001, 43.62449, -79.38346, 43.6255, -79.3769, 43.62652, -79.37034, 43.62754, -79.36379, 43.62856, -79.35723, 43.62957, -79.35068],
];

cityBoundries = {};



cityBoundries['3-CPT'] = [
	//Upper left
	-33.883335, 18.406432,
	//upper right
	-33.916207, 18.482190,
	//lower right
	-33.986281, 18.416868,
	//lower left
	-33.928146, 18.367802
];
cityBoundries['4-DEL'] = [
	//Upper left
	28.646704, 77.210614,
	//upper right
	28.631700, 77.246496,
	//lower right
	28.604083, 77.224511,
	//lower left
	28.623785, 77.180172
	];
cityBoundries['5-DXB'] =[
	//Upper left
 	 25.240883, 55.266705,
	//upper right
	25.220604, 55.307707,
	//lower right
	25.164689, 55.287399,
	//lower left
	25.191280, 55.227056
	];
cityBoundries['6-LDN'] = [
	//Upper left
	 51.522228, -0.141252,
	//upper right
	51.505636, -0.094690,
	//lower right
	51.479329, -0.138679,
	//lower left
	51.502603, -0.183319

	];
cityBoundries['7-MELB'] = [
	//Upper left
	-37.797075, 144.929560,
	//upper right
	-37.785780, 144.990381,
	//lower right
	// - lr =
	-37.826746, 145.012124,
	// - ll =
	-37.832270, 144.950543


	];
cityBoundries['8-MEX'] = [
	// ul =
	19.440709, -99.164739,
	// - ur =
	19.448003, -99.079002,
	// - lr =
	19.381734, -99.072126,
	// - ll =
	19.379098, -99.156144


	];
cityBoundries['1-NYC'] = [
	// - ul =
	40.770340, -73.994651,
	// - ur =
	40.758978, -73.958549,
	// - lr =
	40.741913, -73.972914,
	// - ll =
	40.753631, -74.007501
	];
cityBoundries['9-PAR'] = [
	// - ul =
	48.871733, 2.342533,
	// - ur =
	48.857965, 2.394968,
	// - lr =
	48.812720, 2.361921,
	// - ll =
	48.821134, 2.298911

	];
cityBoundries['2-YTO'] = [
	// - ul =
	43.664690, -79.438654,
	// - ur =
	43.676751, -79.375619,
	// - lr =
	43.629573, -79.350675,
	// - ll =
	43.618387, -79.422794

	];

cityBoundries["center3-CPT"]=[-33.934859, 18.411640];
cityBoundries["center4-DEL"]=[28.622987, 77.223054];
cityBoundries["center5-DXB"]=[25.203614, 55.268254];
cityBoundries["center6-LDN"]=[51.498015, -0.126579];
cityBoundries["center7-MELB"]=[-37.811642, 144.979811];
cityBoundries["center8-MEX"]=[19.419703, -99.142984];
cityBoundries["center1-NYC"]=[40.750806, -73.982859];
cityBoundries["center9-PAR"]=[48.837725, 2.339939];
cityBoundries["center2-YTO"]=[43.643867, -79.385692];


cityBoundries["zoom3-CPT"]=13;
cityBoundries["zoom4-DEL"]=14;
cityBoundries["zoom5-DXB"]=13;
cityBoundries["zoom6-LDN"]=13;
cityBoundries["zoom7-MELB"]=13;
cityBoundries["zoom8-MEX"]=13;
cityBoundries["zoom1-NYC"]=14;
cityBoundries["zoom9-PAR"]=13;
cityBoundries["zoom2-YTO"]=13;


var cityName = '3-CPT';

//heatmap data
var densityList = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 4, 0, 0, 4, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 5, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];


//heatmap stuff
var maxDensity = arrayMax(densityList);
if  (maxDensity< 1)
{
	maxDensity =1;
}

var rainbow = new Rainbow(); // by default, range is 0 to 100
rainbow.setSpectrum('white','red');
rainbow.setNumberRange(0, maxDensity);
//

var mapCenter = cityBoundries['center'+cityName];

var zoomCity = cityBoundries['zoom'+cityName];

L.mapbox.accessToken = 'pk.eyJ1IjoiaGFraGFuMjIxIiwiYSI6ImNrbGMwYmoyMDJ2MzIyb25yMTZuaDhjZHQifQ.tRum-N9eAjVPKp9fGqPm6w';
var map = L.mapbox.map('map')
    .setView(mapCenter, zoomCity)
    .addLayer(L.mapbox.styleLayer('mapbox://styles/mapbox/streets-v11'),{
				center: mapCenter,
				zoom: 11,

			}		);

var greenIcon = L.icon({
			iconUrl: 'dc.png',

			iconSize:     [50, 50], // size of the icon
		});

var bikeMarker = L.Icon.extend({
		options: {
			iconSize: [4, 4],
		}
		});
// add circle to map
/*
var circle = L.circle([40.780970, -73.955982], {
          color: "green",
          fillColor: "#f03",
          fillOpacity: 0.3,
          radius: 1000.0
		}).addTo(map);

*/
	//polygons  = squares on map
	var currentCityPolygons = cityCoords[cityName];
	var colorInd = 0;
  polygonPoints = []
	polygonPoints.push([cityBoundries[cityName][0],cityBoundries[cityName][1]]);

	polygonPoints.push([cityBoundries[cityName][6],cityBoundries[cityName][7]]);
	polygonPoints.push([cityBoundries[cityName][4],cityBoundries[cityName][5]]);
	polygonPoints.push([cityBoundries[cityName][2],cityBoundries[cityName][3]]);
	myColor = rainbow.colourAt(maxDensity);
	myColor = '#'+myColor
	var poly = L.polygon(polygonPoints, {color:myColor,weight:1,fillOpacity: 0}).addTo(map);

	for (index = 0; index < currentCityPolygons.length-1; index++) {
		for (index2 = 0; index2 < currentCityPolygons[index].length-2; index2+=2) {
			var polygonPoints = [];
			x1 = currentCityPolygons[index][index2];
			y1 = currentCityPolygons[index][index2+1];

			x2 = currentCityPolygons[index+1][index2];
			y2 = currentCityPolygons[index+1][index2+1];

			x3 = currentCityPolygons[index][index2+2];
			y3 = currentCityPolygons[index][index2+2+1];

			x4 = currentCityPolygons[index+1][index2+2];
			y4 = currentCityPolygons[index+1][index2+2+1];


			polygonPoints.push([x1,y1]);
			polygonPoints.push([x3,y3]);
			polygonPoints.push([x4,y4]);
			polygonPoints.push([x2,y2]);

			//myColor = colors[ii]
			//var ii = index2%2;

			//var ii = colorInd
			var myColor = '';
			myColor = rainbow.colourAt(densityList[colorInd]);
			myColor = '#'+myColor
			//myColor = rainbow.colourAt(densityList[ii]);
			//myColor = '#'+myColor
			//console.log(ii,myColor)
			fillTransparency = 0.7;
			ii = 13;
			if (densityList[colorInd]<1){
			 fillTransparency = 0;
			}

			console.log(index, index2, densityList[ii],polygonPoints,colorInd,maxDensity);
			var poly = L.polygon(polygonPoints, {color:myColor,weight: 0,fillOpacity: fillTransparency}).addTo(map);
      poly.bindPopup(densityList[colorInd].toString()+" observed vehicles");
			colorInd += 1;
		}
	}



	//legend stuff
	{
		L.LegendControl = L.Control.extend({
				onAdd: function (map) {

					var div = L.DomUtil.create('div', 'info legend');
					var grades = [0, 10, 20, 100, 500];
					var labels = [];
					var from;
					var to;
					max = maxDensity;
					var cp = 0
					labels.push('<div><b>Observed Unique Vehicles</b></div><br />')
					for (var i = 0; i < grades.length; i++) {
						myColor = rainbow.colourAt(Math.floor(cp*max));
						myColor = '#'+myColor
						from = parseInt(cp*max);
						to = parseInt((cp+0.2)*max);

						labels.push(
							'<div><i style="background:' + myColor + '"></i> <font size="5" style="padding-top: 8px;"><b>' +
							from + (to ? '&ndash;' + to : '+') + "</b></font></div>");
						console.log(cp)
						cp += 0.2
					}

					div.innerHTML = labels.join('');
					return div;
				}
			});

			L.legendControl = function(options) {
					return new L.LegendControl(options);
				};
			L.legendControl({position: 'bottomleft'}).addTo(map);
		}

    currentEpoch = Date.now();
    console.log(currentEpoch);
    currentEpoch = float2int(currentEpoch/1000);
    console.log(currentEpoch,lastUpdate);
    var differenceTime = float2int((currentEpoch- lastUpdate)/60);
    console.log(differenceTime);
    document.getElementById("updateTime").innerHTML = " Last Update: "+ differenceTime.toString()+ " minutes ago";
</script>
</body>
</html>
